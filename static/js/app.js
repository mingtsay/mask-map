(()=>{if(!("geolocation"in navigator))return;document.getElementById("unsupported").style.display="none";const e=async(e,t)=>{const n=document.getElementById("tbody");for(;n.hasChildNodes();)n.removeChild(n.firstChild);const o=document.createElement("tr"),l=document.createElement("td");l.colSpan=9,l.textContent="資料正在載入中…",o.appendChild(l),n.appendChild(o);const s=await fetch(e).then(e=>e.json());if(n.removeChild(n.firstChild),!s.features.length){const e=document.createElement("tr"),t=document.createElement("td");return t.colSpan=9,t.textContent="您選擇的條件無任何醫事機構資訊可供顯示。",e.appendChild(t),void n.appendChild(e)}const d=[{key:"name",className:"list-name"},{key:"phone",className:"list-phone"},{key:"address",className:"list-address"},{key:"mask_adult",className:"list-mask list-mask-adult"},{key:"mask_child",className:"list-mask list-mask-child"},{key:"note",className:"list-note"},{key:"custom_note",className:"list-custom_note"},{key:"website",className:"list-website"},{key:"distance",className:"list-distance"}];for(const e in s.features){const o=s.features[e].properties,l=document.createElement("tr");for(const e in d){const n=d[e],s=document.createElement("td");s.textContent="distance"!==n.key?o[n.key]:t?`${o.distance.distance} ${o.distance.unit}`:"不適用",s.className=n.className,l.appendChild(s)}n.appendChild(l)}};document.getElementById("position-obtain").addEventListener("click",()=>{navigator.geolocation.getCurrentPosition(e=>{document.getElementById("position-longitude").value=e.coords.longitude,document.getElementById("position-latitude").value=e.coords.latitude},e=>{alert(`目前位置取得失敗 (${e.code}) ${e.message}`)})}),document.getElementById("form-position").addEventListener("submit",t=>{t.preventDefault();const n=document.getElementById("position-longitude").value,o=document.getElementById("position-latitude").value,l=document.getElementById("list-obtain-limit").value,s=document.getElementById("list-obtain-filter").checked;e(`/list/${n}/${o}?limit=${l}${s?"&filter=on":""}`,!0)}),document.getElementById("tgos-county").addEventListener("change",()=>{const e=document.getElementById("tgos-county").value,t=document.getElementById("tgos-town"),n=document.getElementById("tgos-cunli");for(;t.lastChild.value;)t.removeChild(t.lastChild);for(;n.lastChild.value;)n.removeChild(n.lastChild);for(const n in tgos[e]){if(!tgos.hasOwnProperty(e))continue;const o=document.createElement("option");o.textContent=n,o.value=n,t.appendChild(o)}}),document.getElementById("tgos-town").addEventListener("change",()=>{const e=document.getElementById("tgos-county").value,t=document.getElementById("tgos-town").value,n=document.getElementById("tgos-cunli");for(;n.lastChild.value;)n.removeChild(n.lastChild);for(const o of tgos[e][t]){const e=document.createElement("option");e.textContent=o,e.value=o,n.appendChild(e)}}),document.getElementById("form-tgos").addEventListener("submit",t=>{t.preventDefault();const n=document.getElementById("tgos-county").value,o=document.getElementById("tgos-town").value,l=document.getElementById("tgos-cunli").value,s=document.getElementById("tgos-obtain-limit").value,d=document.getElementById("tgos-obtain-filter").checked;e(`/tgos/${n}/${o}/${l}?limit=${s}${d?"&filter=on":""}`,!1)}),fetch("/tgos").then(e=>e.json()).then(e=>{window.tgos=e;for(const t in e){if(!e.hasOwnProperty(t))continue;const n=document.createElement("option");n.textContent=t,n.value=t,document.getElementById("tgos-county").appendChild(n)}})})();